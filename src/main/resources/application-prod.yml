server:
  port: 8080

spring:
  application:
    name: scheduler_db
  datasource:
    url: jdbc:postgresql://scheduler-postgres:5432/scheduler_db
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    driver-class-name: org.postgresql.Driver
  jpa:
    hibernate:
      ddl-auto: none  # Use Flyway exclusively for schema management; no automatic schema operations
    show-sql: false  # Disabled in production to prevent sensitive data exposure in logs
    properties:
      hibernate:
        format_sql: false  # Disabled in production for security
        use_sql_comments: false  # Disabled in production for security
        jdbc:
          time_zone: America/Chicago
    database-platform: org.hibernate.dialect.PostgreSQLDialect
  mail:
    host: ${MAIL_HOST:smtp.gmail.com}
    port: ${MAIL_PORT:587}
    username: ${MAIL_USERNAME:}
    password: ${MAIL_PASSWORD:}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    out-of-order: true
    validate-on-migrate: false

app:
  jwt:
    secret: ${JWT_SECRET:NUkpwZybKi2HGV0AHPf704rpGkubj94WXL7hYH7hoyDs}
    expiration: 86400000 # 24 hours
  cors:
    allowed-origins: ${ALLOWED_ORIGINS:https://scheduler.asluxeco.org}
  notification:
    email:
      from: ${EMAIL_FROM:noreply@hotelscheduler.com}
      enabled: ${EMAIL_ENABLED:true}
    base-url: ${NOTIFICATION_BASE_URL:https://useshiftly.com}

# Enhanced Security Configuration
security:
  rate-limit:
    requests-per-minute: ${RATE_LIMIT_RPM:60}    # Max requests per minute per IP
    burst-threshold: ${RATE_LIMIT_BURST:10}      # Warning threshold for burst detection
    block-duration-minutes: ${RATE_LIMIT_BLOCK:15}  # Block duration in minutes
    cleanup-interval-minutes: 5                  # Cleanup interval for expired entries
  
  abuse:
    enabled: ${ABUSE_DETECTION_ENABLED:true}     # Enable/disable abuse detection
    auth-failure-threshold: ${AUTH_FAILURE_THRESHOLD:10}  # Failed auth attempts before block
    detection-window-minutes: ${ABUSE_WINDOW:60} # Time window for abuse detection
    temp-block-duration-minutes: ${TEMP_BLOCK_DURATION:30}  # Temporary block duration
    perm-block-threshold: ${PERM_BLOCK_THRESHOLD:3}  # Violations before permanent block
  
  monitoring:
    alert-threshold: ${SECURITY_ALERT_THRESHOLD:100}  # Events before triggering alert
    time-window-minutes: ${SECURITY_ALERT_WINDOW:10}  # Alert time window
    
  enhanced-logging:
    enabled: ${ENHANCED_LOGGING:true}            # Enable structured security logging
    log-level: ${SECURITY_LOG_LEVEL:WARN}       # Minimum log level for security events

logging:
  file:
    name: logs/hotel-scheduler.log
  level:
    com.hotel.scheduler: INFO
    org.springframework.security: INFO  # Reduced from DEBUG to avoid exposing security internals
    org.hibernate.SQL: INFO  # Reduced from DEBUG to prevent SQL query logging in production
    org.hibernate.type.descriptor.sql: INFO  # Reduced from TRACE to avoid verbose type binding logs
  pattern:
    console: "%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
