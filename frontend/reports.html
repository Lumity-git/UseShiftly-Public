<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reports & Analytics - Hotel Scheduler</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <nav class="navbar">
      <div class="nav-container">
        <a href="dashboard.html" class="logo">
          <i class="fas fa-hotel"></i> Hotel Scheduler
        </a>
        <div class="nav-links" id="navigation">
          <!-- Navigation will be populated based on user role -->
        </div>
        <div class="user-info">
          <span id="userName">Loading...</span>
          <button class="logout-btn" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i> Logout
          </button>
        </div>
      </div>
    </nav>

    <div class="container">
      <div class="report-filters">
        <div class="filter-row">
          <div class="filter-group">
            <label for="startDate">Start Date</label>
            <input type="date" id="startDate" />
          </div>
          <div class="filter-group">
            <label for="endDate">End Date</label>
            <input type="date" id="endDate" />
          </div>
          <div class="filter-group">
            <label for="departmentFilter">Department</label>
            <select id="departmentFilter">
              <option value="">All Departments</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="employeeFilter">Employee</label>
            <select id="employeeFilter">
              <option value="">All Employees</option>
            </select>
          </div>
          <div class="filter-group">
            <label>&nbsp;</label>
            <button class="btn btn-primary" onclick="generateReports()">
              <i class="fas fa-chart-line"></i> Generate Reports
            </button>
          </div>
        </div>
      </div>

      <div class="stats-grid" id="statsGrid">
        <div class="loading">
          <i class="fas fa-spinner"></i>
          <p>Loading statistics...</p>
        </div>
      </div>

      <div class="chart-grid" id="chartGrid">
        <!-- Charts will be inserted here -->
      </div>

      <div class="table-card" id="employeeHoursTable" style="display: none">
        <h3><i class="fas fa-clock"></i> Employee Hours Summary</h3>
        <div style="overflow-x: auto">
          <table class="data-table">
            <thead>
              <tr>
                <th>Employee</th>
                <th>Department</th>
                <th>Total Hours</th>
                <th>Regular Hours</th>
                <th>Overtime Hours</th>
                <th>Shifts Worked</th>
                <th>Avg Hours/Day</th>
              </tr>
            </thead>
            <tbody id="employeeHoursBody"></tbody>
          </table>
        </div>
      </div>

      <div class="table-card" id="departmentStatsTable" style="display: none">
        <h3><i class="fas fa-building"></i> Department Performance</h3>
        <div style="overflow-x: auto">
          <table class="data-table">
            <thead>
              <tr>
                <th>Department</th>
                <th>Total Shifts</th>
                <th>Total Hours</th>
                <th>Active Employees</th>
                <th>Avg Hours/Employee</th>
                <th>Shift Coverage %</th>
              </tr>
            </thead>
            <tbody id="departmentStatsBody"></tbody>
          </table>
        </div>
      </div>

      <div class="export-section">
        <h3><i class="fas fa-download"></i> Export Reports</h3>
        <p>Download your reports in various formats for further analysis</p>
        <div class="export-buttons">
          <button class="btn btn-success" onclick="exportToCSV()">
            <i class="fas fa-file-csv"></i> Export CSV
          </button>
          <button class="btn btn-primary" onclick="exportToPDF()">
            <i class="fas fa-file-pdf"></i> Export PDF
          </button>
          <button class="btn btn-success" onclick="exportToExcel()">
            <i class="fas fa-file-excel"></i> Export Excel
          </button>
        </div>
      </div>
    </div>

    <script>
      let currentUser = null;
      let reportData = {};
      let charts = {};

      document.addEventListener("DOMContentLoaded", async function () {
        if (!authManager.checkAuth(["MANAGER", "ADMIN"])) return;

        // Load user info and set up navigation
        const user = localStorage.getItem("userInfo");
        let userRole = "";
        if (user) {
          const userObj = JSON.parse(user);
          document.getElementById("userName").textContent =
            userObj.firstName + " " + userObj.lastName;
          userRole = userObj.role;
        }
        setupNavigation(userRole);

        initializeDateFilters();
        generateReports();
      });

      async function checkAuth() {
        const token = localStorage.getItem("authToken");
        const user = localStorage.getItem("userInfo");

        if (!token || !user) {
          window.location.href = "login.html";
          return false;
        }

        const userObj = JSON.parse(user);

        // Redirect employees to their own dashboard (reports are admin/manager only)
        if (userObj.role === "EMPLOYEE") {
          window.location.href = "employee-dashboard.html";
          return false;
        }

        try {
          // Validate token by making a test API call
          const response = await fetch(
            "http://localhost:8080/api/auth/validate",
            {
              method: "GET",
              headers: {
                Authorization: `Bearer ${token}`,
                "Content-Type": "application/json",
              },
            }
          );

          if (!response.ok) {
            localStorage.removeItem("authToken");
            localStorage.removeItem("userInfo");
            window.location.href = "login.html";
            return false;
          }
        } catch (error) {
          console.error("Auth validation failed:", error);
          localStorage.removeItem("authToken");
          localStorage.removeItem("userInfo");
          window.location.href = "login.html";
          return false;
        }

        currentUser = JSON.parse(user);
        document.getElementById("userName").textContent =
          currentUser.firstName + " " + currentUser.lastName;
        setupNavigation(currentUser.role);

        loadInitialData();
        return true;
      }

      function setupNavigation(userRole) {
        const navigation = document.getElementById("navigation");
        let navLinks = "";
        // Common links for all users
        navLinks += '<a href="dashboard.html" class="nav-link">Dashboard</a>';
        navLinks += '<a href="shifts.html" class="nav-link">Shifts</a>';
        navLinks += '<a href="trades.html" class="nav-link">Trades</a>';
        navLinks += '<a href="notifications.html" class="nav-link">Notifications</a>';
        // Manager and Admin only links
        if (userRole === "MANAGER" || userRole === "ADMIN") {
          navLinks += '<a href="employees.html" class="nav-link">Employees</a>';
          navLinks += '<a href="reports.html" class="nav-link active">Reports</a>';
          navLinks += '<a href="departments.html" class="nav-link">Departments</a>';
        }
        navigation.innerHTML = navLinks;
      }

      function initializeDateFilters() {
        const today = new Date();
        const thirtyDaysAgo = new Date(
          today.getTime() - 30 * 24 * 60 * 60 * 1000
        );

        document.getElementById("startDate").value = thirtyDaysAgo
          .toISOString()
          .split("T")[0];
        document.getElementById("endDate").value = today
          .toISOString()
          .split("T")[0];
      }

      async function loadInitialData() {
        await Promise.all([
          loadDepartments(),
          loadEmployees(),
          generateReports(),
        ]);
      }

      // Configuration
      const API_BASE_URL = "http://localhost:8080/api";

      async function loadDepartments() {
        try {
          const token = localStorage.getItem("authToken");
          const response = await fetch(`${API_BASE_URL}/departments`, {
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
          });

          if (response.ok) {
            const departments = await response.json();
            populateDepartmentFilter(departments);
          }
        } catch (error) {
          console.error("Error loading departments:", error);
        }
      }

      async function loadEmployees() {
        try {
          const token = localStorage.getItem("authToken");
          const response = await fetch(`${API_BASE_URL}/employees`, {
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
          });

          if (response.ok) {
            const employees = await response.json();
            populateEmployeeFilter(employees);
          }
        } catch (error) {
          console.error("Error loading employees:", error);
        }
      }

      function populateDepartmentFilter(departments) {
        const select = document.getElementById("departmentFilter");
        select.innerHTML =
          '<option value="">All Departments</option>' +
          departments
            .map((dept) => `<option value="${dept.id}">${dept.name}</option>`)
            .join("");
      }

      function populateEmployeeFilter(employees) {
        const select = document.getElementById("employeeFilter");
        select.innerHTML =
          '<option value="">All Employees</option>' +
          employees
            .map(
              (emp) =>
                `<option value="${emp.id}">${emp.firstName} ${emp.lastName}</option>`
            )
            .join("");
      }

      async function generateReports() {
        showLoading();

        try {
          const params = {
            startDate: document.getElementById("startDate").value,
            endDate: document.getElementById("endDate").value,
            departmentId: document.getElementById("departmentFilter").value,
            employeeId: document.getElementById("employeeFilter").value,
          };

          await Promise.all([
            loadStatistics(params),
            loadShiftData(params),
            loadEmployeeHours(params),
            loadDepartmentStats(params),
          ]);

          renderCharts();
          hideLoading();
        } catch (error) {
          console.error("Error generating reports:", error);
          showError("Failed to generate reports");
          hideLoading();
        }
      }

      async function loadStatistics(params) {
        try {
          const token = localStorage.getItem("authToken");
          const queryString = new URLSearchParams(params).toString();
          const response = await fetch(
            `${API_BASE_URL}/reports/statistics?${queryString}`,
            {
              headers: {
                Authorization: `Bearer ${token}`,
                "Content-Type": "application/json",
              },
            }
          );

          if (response.ok) {
            reportData.statistics = await response.json();
            renderStatistics();
          } else {
            reportData.statistics = generateMockStatistics();
            renderStatistics();
          }
        } catch (error) {
          console.error("Error loading statistics:", error);
          reportData.statistics = generateMockStatistics();
          renderStatistics();
        }
      }

      async function loadShiftData(params) {
        try {
          const token = localStorage.getItem("authToken");
          const queryString = new URLSearchParams(params).toString();
          // Fetch all shift-related analytics in parallel
          const [
            shiftsByDayRes,
            hoursByDeptRes,
            shiftDistRes,
            monthlyTrendRes,
          ] = await Promise.all([
            fetch(`${API_BASE_URL}/reports/shifts-by-day?${queryString}`, {
              headers: {
                Authorization: `Bearer ${token}`,
                "Content-Type": "application/json",
              },
            }),
            fetch(
              `${API_BASE_URL}/reports/hours-by-department?${queryString}`,
              {
                headers: {
                  Authorization: `Bearer ${token}`,
                  "Content-Type": "application/json",
                },
              }
            ),
            fetch(`${API_BASE_URL}/reports/shift-distribution?${queryString}`, {
              headers: {
                Authorization: `Bearer ${token}`,
                "Content-Type": "application/json",
              },
            }),
            fetch(`${API_BASE_URL}/reports/monthly-trend?${queryString}`, {
              headers: {
                Authorization: `Bearer ${token}`,
                "Content-Type": "application/json",
              },
            }),
          ]);

          reportData.shiftData = {
            shiftsByDay: shiftsByDayRes.ok
              ? await shiftsByDayRes.json()
              : generateMockShiftData().shiftsByDay,
            hoursByDepartment: hoursByDeptRes.ok
              ? await hoursByDeptRes.json()
              : generateMockShiftData().hoursByDepartment,
            shiftDistribution: shiftDistRes.ok
              ? await shiftDistRes.json()
              : generateMockShiftData().shiftDistribution,
            monthlyTrend: monthlyTrendRes.ok
              ? await monthlyTrendRes.json()
              : {
                  labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"],
                  data: [1200, 1150, 1300, 1250, 1400, 1248],
                },
          };
        } catch (error) {
          console.error("Error loading shift data:", error);
          reportData.shiftData = generateMockShiftData();
        }
      }

      async function loadEmployeeHours(params) {
        try {
          const token = localStorage.getItem("authToken");
          const queryString = new URLSearchParams(params).toString();
          const response = await fetch(
            `${API_BASE_URL}/reports/employee-hours?${queryString}`,
            {
              headers: {
                Authorization: `Bearer ${token}`,
                "Content-Type": "application/json",
              },
            }
          );

          if (response.ok) {
            reportData.employeeHours = await response.json();
          } else {
            reportData.employeeHours = generateMockEmployeeHours();
          }
          renderEmployeeHoursTable();
        } catch (error) {
          console.error("Error loading employee hours:", error);
          reportData.employeeHours = generateMockEmployeeHours();
          renderEmployeeHoursTable();
        }
      }

      async function loadDepartmentStats(params) {
        try {
          const token = localStorage.getItem("authToken");
          const queryString = new URLSearchParams(params).toString();
          const response = await fetch(
            `${API_BASE_URL}/reports/department-performance?${queryString}`,
            {
              headers: {
                Authorization: `Bearer ${token}`,
                "Content-Type": "application/json",
              },
            }
          );

          if (response.ok) {
            reportData.departmentStats = await response.json();
          } else {
            reportData.departmentStats = generateMockDepartmentStats();
          }
          renderDepartmentStatsTable();
        } catch (error) {
          console.error("Error loading department stats:", error);
          reportData.departmentStats = generateMockDepartmentStats();
          renderDepartmentStatsTable();
        }
      }

      function generateMockStatistics() {
        return {
          totalShifts: 156,
          totalHours: 1248,
          averageHoursPerEmployee: 32.5,
          overtimeHours: 48,
          shiftCoverage: 94.2,
          activeEmployees: 12,
          pendingTrades: 3,
          completedTrades: 8,
        };
      }

      function generateMockShiftData() {
        return {
          shiftsByDay: {
            labels: ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"],
            data: [22, 25, 23, 26, 24, 18, 16],
          },
          hoursByDepartment: {
            labels: ["Front Desk", "Housekeeping", "Kitchen", "Maintenance"],
            data: [320, 280, 450, 198],
          },
          shiftDistribution: {
            labels: ["Morning", "Afternoon", "Evening", "Night"],
            data: [45, 38, 35, 26],
          },
        };
      }

      function generateMockEmployeeHours() {
        return [
          {
            name: "John Smith",
            department: "Front Desk",
            totalHours: 40,
            regularHours: 40,
            overtimeHours: 0,
            shifts: 5,
            avgHours: 8.0,
          },
          {
            name: "Sarah Johnson",
            department: "Housekeeping",
            totalHours: 42,
            regularHours: 40,
            overtimeHours: 2,
            shifts: 6,
            avgHours: 7.0,
          },
          {
            name: "Mike Wilson",
            department: "Kitchen",
            totalHours: 38,
            regularHours: 38,
            overtimeHours: 0,
            shifts: 5,
            avgHours: 7.6,
          },
          {
            name: "Emily Davis",
            department: "Front Desk",
            totalHours: 35,
            regularHours: 35,
            overtimeHours: 0,
            shifts: 5,
            avgHours: 7.0,
          },
        ];
      }

      function generateMockDepartmentStats() {
        return [
          {
            name: "Front Desk",
            totalShifts: 45,
            totalHours: 360,
            employees: 4,
            avgHours: 90,
            coverage: 95.5,
          },
          {
            name: "Housekeeping",
            totalShifts: 52,
            totalHours: 416,
            employees: 5,
            avgHours: 83.2,
            coverage: 92.8,
          },
          {
            name: "Kitchen",
            totalShifts: 38,
            totalHours: 304,
            employees: 3,
            avgHours: 101.3,
            coverage: 88.2,
          },
          {
            name: "Maintenance",
            totalShifts: 21,
            totalHours: 168,
            employees: 2,
            avgHours: 84,
            coverage: 91.0,
          },
        ];
      }

      function renderStatistics() {
        const stats = reportData.statistics;
        const statsGrid = document.getElementById("statsGrid");

        statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-icon" style="color: #667eea;">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="stat-number" style="color: #667eea;">${stats.totalShifts}</div>
                    <div class="stat-label">Total Shifts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="color: #28a745;">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-number" style="color: #28a745;">${stats.totalHours}</div>
                    <div class="stat-label">Total Hours</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="color: #17a2b8;">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-number" style="color: #17a2b8;">${stats.activeEmployees}</div>
                    <div class="stat-label">Active Employees</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="color: #ffc107;">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-number" style="color: #ffc107;">${stats.averageHoursPerEmployee}</div>
                    <div class="stat-label">Avg Hours/Employee</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="color: #dc3545;">
                        <i class="fas fa-business-time"></i>
                    </div>
                    <div class="stat-number" style="color: #dc3545;">${stats.overtimeHours}</div>
                    <div class="stat-label">Overtime Hours</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="color: #6f42c1;">
                        <i class="fas fa-percentage"></i>
                    </div>
                    <div class="stat-number" style="color: #6f42c1;">${stats.shiftCoverage}%</div>
                    <div class="stat-label">Shift Coverage</div>
                </div>
            `;
      }

      function renderCharts() {
        const chartGrid = document.getElementById("chartGrid");
        chartGrid.innerHTML = `
                <div class="chart-card">
                    <h3>Shifts by Day of Week</h3>
                    <div class="chart-container">
                        <canvas id="shiftsByDayChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>Hours by Department</h3>
                    <div class="chart-container">
                        <canvas id="hoursByDepartmentChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>Shift Distribution by Time</h3>
                    <div class="chart-container">
                        <canvas id="shiftDistributionChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>Monthly Trend</h3>
                    <div class="chart-container">
                        <canvas id="monthlyTrendChart"></canvas>
                    </div>
                </div>
            `;

        // Render charts
        renderShiftsByDayChart();
        renderHoursByDepartmentChart();
        renderShiftDistributionChart();
        renderMonthlyTrendChart();
      }

      function renderShiftsByDayChart() {
        const ctx = document
          .getElementById("shiftsByDayChart")
          .getContext("2d");
        const data = reportData.shiftData.shiftsByDay;

        charts.shiftsByDay = new Chart(ctx, {
          type: "bar",
          data: {
            labels: data.labels,
            datasets: [
              {
                label: "Number of Shifts",
                data: data.data,
                backgroundColor: "rgba(102, 126, 234, 0.6)",
                borderColor: "rgba(102, 126, 234, 1)",
                borderWidth: 1,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
              },
            },
          },
        });
      }

      function renderHoursByDepartmentChart() {
        const ctx = document
          .getElementById("hoursByDepartmentChart")
          .getContext("2d");
        const data = reportData.shiftData.hoursByDepartment;

        charts.hoursByDepartment = new Chart(ctx, {
          type: "doughnut",
          data: {
            labels: data.labels,
            datasets: [
              {
                data: data.data,
                backgroundColor: [
                  "rgba(102, 126, 234, 0.8)",
                  "rgba(40, 167, 69, 0.8)",
                  "rgba(255, 193, 7, 0.8)",
                  "rgba(220, 53, 69, 0.8)",
                ],
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
          },
        });
      }

      function renderShiftDistributionChart() {
        const ctx = document
          .getElementById("shiftDistributionChart")
          .getContext("2d");
        const data = reportData.shiftData.shiftDistribution;

        charts.shiftDistribution = new Chart(ctx, {
          type: "pie",
          data: {
            labels: data.labels,
            datasets: [
              {
                data: data.data,
                backgroundColor: [
                  "rgba(255, 206, 84, 0.8)",
                  "rgba(54, 162, 235, 0.8)",
                  "rgba(255, 99, 132, 0.8)",
                  "rgba(75, 192, 192, 0.8)",
                ],
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
          },
        });
      }

      function renderMonthlyTrendChart() {
        const ctx = document
          .getElementById("monthlyTrendChart")
          .getContext("2d");
        const data = reportData.shiftData.monthlyTrend || {
          labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"],
          data: [1200, 1150, 1300, 1250, 1400, 1248],
        };
        charts.monthlyTrend = new Chart(ctx, {
          type: "line",
          data: {
            labels: data.labels,
            datasets: [
              {
                label: "Total Hours",
                data: data.data,
                borderColor: "rgba(102, 126, 234, 1)",
                backgroundColor: "rgba(102, 126, 234, 0.1)",
                fill: true,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
              },
            },
          },
        });
      }

      function renderEmployeeHoursTable() {
        const tbody = document.getElementById("employeeHoursBody");
        const data = reportData.employeeHours;

        tbody.innerHTML = data
          .map(
            (emp) => `
                <tr>
                    <td>${emp.name}</td>
                    <td>${emp.department}</td>
                    <td>${emp.totalHours}</td>
                    <td>${emp.regularHours}</td>
                    <td>${emp.overtimeHours}</td>
                    <td>${emp.shifts}</td>
                    <td>${emp.avgHours.toFixed(1)}</td>
                </tr>
            `
          )
          .join("");

        document.getElementById("employeeHoursTable").style.display = "block";
      }

      function renderDepartmentStatsTable() {
        const tbody = document.getElementById("departmentStatsBody");
        const data = reportData.departmentStats;

        tbody.innerHTML = data
          .map(
            (dept) => `
                <tr>
                    <td>${dept.name}</td>
                    <td>${dept.totalShifts}</td>
                    <td>${dept.totalHours}</td>
                    <td>${dept.employees}</td>
                    <td>${dept.avgHours.toFixed(1)}</td>
                    <td>${dept.coverage.toFixed(1)}%</td>
                </tr>
            `
          )
          .join("");

        document.getElementById("departmentStatsTable").style.display = "block";
      }

      function showLoading() {
        document.getElementById("statsGrid").innerHTML = `
                <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>Generating reports...</p>
                </div>
            `;
        document.getElementById("chartGrid").innerHTML = "";
      }

      function hideLoading() {
        // Loading is hidden when content is rendered
      }

      async function exportToCSV() {
        try {
          showLoading();
          const token = localStorage.getItem("authToken");
          const response = await fetch(`${API_BASE_URL}/employees`, {
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
          });

          if (!response.ok) {
            throw new Error("Failed to fetch employee data");
          }

          const employees = await response.json();

          // Create CSV content
          const headers = [
            "ID",
            "First Name",
            "Last Name",
            "Email",
            "Phone",
            "Department",
            "Role",
            "Hire Date",
          ];
          const csvContent = [
            headers.join(","),
            ...employees.map((emp) =>
              [
                emp.id,
                `"${emp.firstName}"`,
                `"${emp.lastName}"`,
                `"${emp.email}"`,
                `"${emp.phoneNumber || ""}"`,
                `"${emp.departmentName || ""}"`,
                emp.role,
                emp.hireDate || "",
              ].join(",")
            ),
          ].join("\n");

          // Download CSV
          const blob = new Blob([csvContent], { type: "text/csv" });
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `employee-directory-${
            new Date().toISOString().split("T")[0]
          }.csv`;
          a.click();
          window.URL.revokeObjectURL(url);

          hideLoading();
          showSuccess("Employee directory exported to CSV successfully!");
        } catch (error) {
          hideLoading();
          showError("Failed to export employee directory: " + error.message);
        }
      }

      async function exportToPDF() {
        try {
          showLoading();
          const token = localStorage.getItem("authToken");
          const response = await fetch(`${API_BASE_URL}/employees`, {
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
          });

          if (!response.ok) {
            throw new Error("Failed to fetch employee data");
          }

          const employees = await response.json();

          // Create a simple PDF-like content (HTML that can be printed to PDF)
          const printWindow = window.open("", "_blank");
          printWindow.document.write(`
                    <html>
                    <head>
                        <title>Employee Directory</title>
                        <!-- Styles moved to style.css -->
                    </head>
                    <body>
                        <h1>Hotel Employee Directory</h1>
                        <div class="export-date">Generated on: ${new Date().toLocaleDateString()}</div>
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Department</th>
                                    <th>Role</th>
                                    <th>Hire Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${employees
                                  .map(
                                    (emp) => `
                                    <tr>
                                        <td>${emp.id}</td>
                                        <td>${emp.firstName} ${
                                      emp.lastName
                                    }</td>
                                        <td>${emp.email}</td>
                                        <td>${emp.phoneNumber || "N/A"}</td>
                                        <td>${emp.departmentName || "N/A"}</td>
                                        <td>${emp.role}</td>
                                        <td>${emp.hireDate || "N/A"}</td>
                                    </tr>
                                `
                                  )
                                  .join("")}
                            </tbody>
                        </table>
                    </body>
                    </html>
                `);
          printWindow.document.close();

          // Trigger print dialog
          setTimeout(() => {
            printWindow.print();
          }, 500);

          hideLoading();
          showSuccess(
            "PDF export opened in new window. Use browser print function to save as PDF."
          );
        } catch (error) {
          hideLoading();
          showError("Failed to export employee directory: " + error.message);
        }
      }

      function exportToExcel() {
        // Mock implementation
        showSuccess("Excel export initiated. Download will start shortly.");
      }

      function showSuccess(message) {
        alert("Success: " + message);
      }

      function showError(message) {
        alert("Error: " + message);
      }

      function logout() {
        localStorage.removeItem("authToken");
        localStorage.removeItem("userInfo");
        window.location.href = "login.html";
      }
    </script>
    <script src="auto-logout.js"></script>
    <script src="auth-manager.js"></script>
  </body>
</html>
